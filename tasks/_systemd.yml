---
# service_name: required
# service_enabled: true

- name: Deploy systemd unit {{ service_name }}
  ansible.builtin.template:
    src: systemd/{{ service_name }}.j2
    dest: /usr/lib/systemd/system/{{ service_name }}
    owner: root
    group: root
    mode: 0644
  register: systemd

- name: Reload systemd daemon # noqa no-handler
  ansible.builtin.systemd:
    daemon_reload: true
  when: systemd is changed

- name: Enable systemd unit {{ service_name }}
  ansible.builtin.systemd:
    name: "{{ service_name }}"
    enabled: "{{ service_enabled | default(true) }}"
